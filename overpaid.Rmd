---
title: "The Premier League's Most Overpaid Players"
author: "Micah Williams"
date: "2/20/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(readr)
library(tidyverse)
library(dplyr)
library(gt)
```

```{r import, message = F}

# name cleaning process:
  # filter out single-named players (ex. Willian or Rodri)
  # separate first name from last name
  # switch name order ('Firstname' 'Lastname' instead of 'Lastname' 'Firstname')
  # recombine in new column, drop original name columns

# import contract data
pay_2020 <- read_csv('data/pay_complete.csv', na = c(NA, '', '-')) %>%
  mutate(contract_length = parse_number(contract_length))

# import player statistics from '18-'19 season
stats_2019 <- read_csv('data/stats_complete_2018.csv') %>% mutate('season' = 2019)

# import player statistics from '19-'20 season
stats_2020 <- read_csv('data/stats_complete.csv') %>% mutate('season' = 2020) 

# combine '19-'20 data with '18-'19 data
combined <- stats_2020 %>% bind_rows(stats_2019)

# save rows with single-name players
single_names <- combined %>% filter(!str_detect(player, ','))

# clean player names
combined <- combined %>%
  filter(str_detect(player, ',')) %>%
  separate(player, c('lastname','firstname'), ', ') %>%
  mutate(player = paste(firstname, lastname, sep = ' ')) %>%
  select(player, everything()) %>%
  select(-c(firstname, lastname)) %>%
  bind_rows(single_names)

rm(single_names, stats_2020, stats_2019)
```


```{r}
prem <- pay_2020 %>%
  inner_join(combined, by = 'player')

prem %>% summarize(mean_age = mean(age, na.rm = TRUE))
```

